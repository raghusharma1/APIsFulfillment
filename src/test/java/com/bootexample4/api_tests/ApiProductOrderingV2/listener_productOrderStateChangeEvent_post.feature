# ********RoostGPT********

# Test generated by RoostGPT for test sampleArtilleryEnv2 using AI Type  and AI Model 
# 
# Feature file generated for /listener/productOrderStateChangeEvent_post for http method type POST 
# RoostTestHash=a9bfb68d42
# 
# 

# ********RoostGPT********
Feature: State Change Event By Client

  Background:
    * def urlBase = karate.properties['nnnn_URL_BASE'] || karate.get('urlBase', 'http://localhost:4010')
    * url urlBase
    * configure headers = { Authorization: #(karate.properties['nnnn_AUTH_TOKEN']) }

  Scenario Outline: Verify state change notifications with different scenarios
    Given path '/listener/productOrderStateChangeEvent'
    And request
      """
      <body>
      """
    When method POST
    Then status <status>
    And match response == <expectedResponse>

    Examples:
      | body                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | status | expectedResponse |
      | {"notification":{"customer":{"subscriberId":"234567654"},"date":"2021-09-29T18:42:24.641-03:00","order":{"associatedDocument":"VTT001","code":"2","correlationOrder":"10","description":"Ordem cancelada","id":"20230315000001","type":"Cancelamento"}}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |    204 | {}               |
      | {"notification":{"customer":{"subscriberId":"234567654"},"date":"2020-12-16T10:09:31-03:00","order":{"associatedDocument":"VTT001","code":"0","correlationOrder":"10","description":"Ordem encerrada com sucesso.","id":"20230315000001","lostEquipment":"True","resource":{"fiberPath":{"items":{"item":[{"name":"enderecoCDO","value":"RUA GENERAL RENATO PAQUET, 199, BARRA DA TIJUCA, RIO DE JANEIRO - RJ 22793913"},{"name":"producer_olt","value":"HUAWEI"},{"name":"CDO","value":"CDOI-4704-PTP.FO.O:45"},{"name":"CDO","value":"CDOI-4704-PTP.FO.I:S32_2_IN 1"},{"name":"estacao","value":"BEL"},{"name":"cnl","value":"CBF"},{"name":"olt","value":"MA-CTO04-GHUA"},{"name":"primaryCable","value":"MA.CTO.F-7.CEO-15/1"},{"name":"secondaryCable","value":"MA.CTO.F-7.CEOS-165"}]}},"gponAccess":"A000009QS"},"type":"Encerramento"}}} |    204 | {}               |
      | {"notification":{"customer":{"subscriberId":"234567654"},"date":"2021-10-26T17:53:25.497-03:00","order":{"associatedDocument":"VTT001","code":"-1","correlationOrder":"10","description":"O Equipamento já está em uso por outro cliente","id":"20230315000001","lostEquipment":"True","resource":{"fiberPath":{"items":""}},"type":"Encerramento"}}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    204 | {}               |

  Scenario: Unauthorized access to the state change endpoint
    Given path '/listener/productOrderStateChangeEvent'
    And request
      """
      {"notification":{"customer":{"subscriberId":"234567654"},"date":"2021-09-29T18:42:24.641-03:00","order":{"associatedDocument":"VTT001","code":"2","correlationOrder":"10","description":"Ordem cancelada","id":"20230315000001","type":"Cancelamento"}}}
      """
    And header Authorization = 'InvalidToken'
    When method POST
    Then status 401

  Scenario: Server error during state change processing
    Given path '/listener/productOrderStateChangeEvent'
    And request
      """
      {"notification":{"customer":{"subscriberId":"234567654"},"date":"2021-09-29T18:42:24.641-03:00","order":{"associatedDocument":"VTT001","code":"2","correlationOrder":"10","description":"Ordem cancelada","id":"20230315000001","type":"Cancelamento"}}}
      """
    When method POST
    Then status 500
